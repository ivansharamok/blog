<!DOCTYPE html>
<html>

<head>
    <title>Dedicated Sitecore processing instance for reporting database historic rebuild</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content="Dedicated Sitecore processing instance for reporting database historic rebuild, experience-analytics, sitecore,xdb,processing, Works on my machine" />
    <meta name="description" content="Dedicated Sitecore processing instance for reporting database historic rebuild, experience-analytics, sitecore,xdb,processing, " />
    <meta name="theme-color" content="#2CA6CB"/>
    <link rel="shortcut icon" type="image/x-icon" media="screen" href="http://localhost:4000/favicon.ico" />
    <link rel="canonical" href="http://localhost:4000/2017-03-30/dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/" />
    <link rel="alternate" type="application/rss+xml" title="Works on my machine" href="/feed.xml"  />

    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.bootcss.com/octicons/3.5.0/octicons.min.css" >
    <!-- <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/style.css" /> -->
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/style.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/highlight.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/post.css" />
    
    <!-- Hide resource from search bots for now -->
    <meta name="robots" content="noindex,nofollow">
</head>


<body>

    <header>
        <nav class="navbar navbar-tiffany rectangle" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://localhost:4000/">Works on my machine</a>
                    <p class="navbar-text">Notes, thoughts, experiments</p>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        
                        <li>
                        <a href="http://localhost:4000/" class="word-keep"><span class="octicon octicon-book"></span></span>&nbsp;&nbsp;Blog</a>
                        </li>
                        
                        
                        <li>
                            <a href="http://localhost:4000/archive/" class="word-keep"><span class="octicon octicon-repo"></span>&nbsp;&nbsp;Archive</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="http://localhost:4000/category/" class="word-keep"><span class="octicon octicon-list-unordered"></span>&nbsp;&nbsp;Category</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li><a href="#stq=" class="search-button"><span class="octicon octicon-search"></span></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>



<div class="main">
    <div class="container">
        <div class="row">
    <div class="content col-lg-9">
        <div class="sheet post">
          <header>
            <h2>Dedicated Sitecore processing instance for reporting database historic rebuild</h2>
            <p class="post-meta">
                <span class="octicon octicon-clock"></span> Mar 30, 2017
            </p>
            <p class="post-tag">
                <span><a href="http://localhost:4000/category/#experience-analytics"><span class="octicon octicon-list-unordered"></span>&nbsp;experience-analytics</a></span>
                <span>
                    <a class="word-keep" href="http://localhost:4000/tags/#sitecore"><span class="octicon octicon-tag"></span>&nbsp;sitecore</a>
                    
                    <a class="word-keep" href="http://localhost:4000/tags/#xdb"><span class="octicon octicon-tag"></span>&nbsp;xdb</a>
                    
                    <a class="word-keep" href="http://localhost:4000/tags/#processing"><span class="octicon octicon-tag"></span>&nbsp;processing</a>
                    
                </span>
            </p>
          </header>
          <hr class="boundary">
          <article>
            <ul id="markdown-toc">
  <li><a href="#configure-processing-instance" id="markdown-toc-configure-processing-instance">Configure processing instance</a></li>
  <li><a href="#configure-connection-string-to-hidden-node" id="markdown-toc-configure-connection-string-to-hidden-node">Configure connection string to hidden node</a></li>
  <li><a href="#configure-aggregation-subsystem-to-use-custom-collectiondata" id="markdown-toc-configure-aggregation-subsystem-to-use-custom-collectiondata">Configure aggregation subsystem to use custom collectionData</a></li>
  <li><a href="#configuration-of-processing-instances" id="markdown-toc-configuration-of-processing-instances">Configuration of processing instances</a></li>
</ul>

<p>Here is an idea how you can have a dedicated Sitecore processing instance to run reporting database rebuild or Path Analyzer map rebuild off of a hidden mongodb secondary node.<br />
Why? - to let primary aggregation/processing instances and mongodb replica set to handle live data and have a separate instance to read historic data from a hidden secondary mongodb node when needed.</p>

<h1 id="configure-processing-instance">Configure processing instance</h1>

<p>First, you need to configure Sitecore instance as a <a href="https://doc.sitecore.net/sitecore_experience_platform/82/setting_up_and_maintaining/xdb/configuring_servers/configure_a_processing_server">processing/aggregation role</a>.</p>

<h1 id="configure-connection-string-to-hidden-node">Configure connection string to hidden node</h1>
<p>Add a hidden node to your mongodb replica set.<br />
For dev and testing purposes you can use <a href="https://gist.github.com/ivansharamok/93c9bca5a0473e1bb8cef3e15a4efc9d/raw">CreateMongoReplicaSet-2nod-1arb-1hid.cmd</a> script to stand up mongodb replica set with a hidden node:<br />
Then add a connection string to <code class="highlighter-rouge">/App_Config/ConnectionStrings.config</code> pointing to the hidden node. Make sure you add <code class="highlighter-rouge">?slaveok=true</code> to the connection string to allow data provider to read from the hidden node.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;connectionStrings&gt;</span>
  .....
  <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">"analytics.hidden"</span> <span class="na">connectionString=</span><span class="s">"mongodb://localhost:27020/sc82_analytics?slaveok=true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/connectionStrings&gt;</span>
</code></pre></div></div>

<h1 id="configure-aggregation-subsystem-to-use-custom-collectiondata">Configure aggregation subsystem to use custom collectionData</h1>
<p>Add another <code class="highlighter-rouge">collectionData</code> configuration to <code class="highlighter-rouge">aggregation</code> section and set it to use connection string to hidden mongodb node. Then set aggregation subsystem processes relevant to historic rebuild to use custom <code class="highlighter-rouge">collectionData</code> configuration.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;configuration</span> <span class="na">xmlns:patch=</span><span class="s">"http://www.sitecore.net/xmlconfig/"</span> <span class="na">xmlns:set=</span><span class="s">"http://www.sitecore.net/xmlconfig/set/"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;sitecore&gt;</span>
    <span class="nt">&lt;aggregation&gt;</span>
      <span class="nt">&lt;aggregationContexts&gt;</span>
        <span class="nt">&lt;interaction&gt;</span>
          <span class="nt">&lt;history&gt;</span>
            <span class="nt">&lt;Source</span> <span class="na">set:ref=</span><span class="s">"aggregation/collectionDataHidden"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/history&gt;</span>
        <span class="nt">&lt;/interaction&gt;</span>
        <span class="nt">&lt;pathAnalyzer&gt;</span>
          <span class="nt">&lt;history&gt;</span>
            <span class="nt">&lt;Source</span> <span class="na">set:ref=</span><span class="s">"aggregation/collectionDataHidden"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/history&gt;</span>
        <span class="nt">&lt;/pathAnalyzer&gt;</span>
      <span class="nt">&lt;/aggregationContexts&gt;</span>
      <span class="c">&lt;!-- Custom Collection Data for hidden mongodb node --&gt;</span>
      <span class="nt">&lt;collectionDataHidden</span> <span class="na">type=</span><span class="s">"Sitecore.Analytics.Aggregation.MongoDbCollectionDataProvider, Sitecore.Analytics.MongoDB"</span> <span class="na">singleInstance=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">desc=</span><span class="s">"connectionStringName"</span><span class="nt">&gt;</span>analytics.hidden<span class="nt">&lt;/param&gt;</span>
      <span class="nt">&lt;/collectionDataHidden&gt;</span>
      <span class="nt">&lt;historyTaskManager&gt;</span>
        <span class="nt">&lt;CollectionData</span> <span class="na">set:ref=</span><span class="s">"aggregation/collectionDataHidden"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/historyTaskManager&gt;</span>
      <span class="nt">&lt;historyWorker&gt;</span>
        <span class="nt">&lt;CollectionData</span> <span class="na">set:ref=</span><span class="s">"aggregation/collectionDataHidden"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/historyWorker&gt;</span>
    <span class="nt">&lt;/aggregation&gt;</span>
  <span class="nt">&lt;/sitecore&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>

<p>Download example <a href="/resources/media/2017-04-30-dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/Dedicated.Processing.ReportingDb.Historic.Rebuild.config">Dedicated.Processing.ReportingDb.Historic.Rebuild.config</a> patch config file.</p>

<h1 id="configuration-of-processing-instances">Configuration of processing instances</h1>
<p>Keep in mind that above configuration steps would set you up with Sitecore processing instance that is capable to run reporting database rebuild off of a hidden mongodb node but it does not aggregate live analytical data that is being written to your xDB. Before you run histori rebuild of your reporting database, you need to make sure that primary processing/aggregation instance and dedicated processing/aggregation instance for history rebuilds are configured to point to the same <code class="highlighter-rouge">reporting</code> and <code class="highlighter-rouge">reporting.secondary</code> databases. In other words these connection strings must be present in all processing/aggregation instances and point to the same databases:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;connectionStrings&gt;</span>
  .....
  <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">"reporting"</span> <span class="na">connectionString=</span><span class="s">"Data Source=.\SQLEXPRESS;Initial Catalog=sc82_reporting;Integrated Security=False;User ID=sa;Password=example"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">"reporting.secondary"</span> <span class="na">connectionString=</span><span class="s">"Data Source=.\SQLEXPRESS;Initial Catalog=sc82_reporting_secondary;User ID=sa;Password=example"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/connectionStrings&gt;</span>
</code></pre></div></div>

<p>When reporting database historic rebuild is required, you can start it from dedicated reporting historic rebuild instance and let your primary servers work on live data. When rebuild is finished, <a href="/resources/media/2017-04-30-dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/Dedicated.Processing.ReportingDb.Historic.Rebuild.config">reconfigure reporting connection strings</a> on all processing/aggregation instances`.</p>
<blockquote>
  <p><strong>Note</strong><br />
Path Analyzer map rebuild process works with active reporting database. Therefore, you donâ€™t need to reconfigure reporting connection strings after you execute Path Analyzer map rebuild.</p>
</blockquote>


          </article>
          <hr class="boundary">
          <div id="post-share">
              <!-- Go to www.addthis.com/dashboard to customize your tools -->
              <div class="addthis_inline_share_toolbox"></div>
          </div>
        </div>
        <div class="pad-min"></div>
        <div id="post-comment" class="sheet post">
            <div id="disqus_thread"></div>
        </div>
    </div>
    <div class="content-navigation col-lg-3">
      <div class="shadow-bottom-center" >
        <div class="content-navigation-toc">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Toc
            </div>
            <div class="content-navigation-list toc"></div>
        </div>
        <div class="content-navigation-tag">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Tags
            </div>
            <div class="content-navigation-list">
                <ul>
                    
                    <li>
                        <a href="http://localhost:4000/tags#sitecore"><span class="octicon octicon-tag"></span>&nbsp;sitecore</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tags#xdb"><span class="octicon octicon-tag"></span>&nbsp;xdb</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tags#processing"><span class="octicon octicon-tag"></span>&nbsp;processing</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="content-navigation-related">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Related
            </div>
            <div class="content-navigation-list">
                <ul>
                    

                    

                    
                        
                            <li>
                                <a href="http://localhost:4000/2017-11-24/publishing-service-in-docker-container/">Sitecore Publishing Service in Docker Windows Container</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-01-05/configure-sitecore-indexes-for-centralized-indexing-solution/">Configure Sitecore indexes for centralized indexing solution</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-01-04/configure-basicauth-for-solr-provider/">Configure BasicAuthentication for Solr provider with Sitecore</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2016-12-30/script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/">MSDeploy Sitecore installation using SolrCloud with SwitchOnRebuild index</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2016-12-10/customize-sitecore-azuretoolkit-deployment/">Customize Sitecore Azure toolkit deployment</a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
      </div>
    </div>
</div>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a24c44d9a3c0d22"></script>
    </div>
    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
</div>

    <footer  class="footnote footnote-tiffany">
        <div class="container">
                <a class="foot-item" href="mailto:" target="_blank"><span class="octicon octicon-mail"></span></a>
                <a class="foot-item" href="https://github.com/ivansharamok" target="_blank"><span class="octicon octicon-mark-github"></span></a>
                <a class="foot-item" href="http://localhost:4000/feed.xml" target="_blank"><span class="octicon octicon-rss"></span></a>
                <!-- <a class="foot-item" href="http://localhost:4000/link/"><span class="octicon octicon-link-external"></span></a> -->
                &nbsp;
                <a href="http://blog.sharamok.com/"><span class="word-keep">&copy; Ivan Sharamok</span></a>
        </div>
        <div class="credit">
            Credit to WakelessDragon for <a href="https://github.com/WakelessDragon/blog">Jekyll site theme</a>.
        </div>
    </footer>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://localhost:4000/static/js/script.js"></script>
    <script type="text/javascript" src="http://localhost:4000/static/js/post.js"></script>
    


</body>
</html>
